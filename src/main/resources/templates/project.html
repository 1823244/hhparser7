<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" data-bs-theme="dark">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <div th:include="~{fragments/head::commonHead}"></div>
    <title th:text="${pageTitle}">Page title</title>

</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- PROJECT TITLE -->
<div class="container">
    <p>Today is: <span th:text="${today}">13 February 2011</span></p>
    <H3>Project: <span th:text="${project.getName()}"></span></H3>
</div>

<!-- START SEARCH -->
<div class="container">
    <form th:method="POST" th:action="@{/projects/{id}/search(id=${project.getId()})}" >
        <input class="btn btn-secondary" type="submit" value="Start search" />
    </form>
</div>

<!-- TASK LABEL -->
<div class="container">
    <H5> Last task: <span th:text="${task.getName()}+' - started at: '+${task.getStartTime()}+' - finished at: '+${task.getEndTime()}"></span></H5>
</div>

<div class="container">
    <table>
        <tr>
            <td>
                <!-- EDIT BUTTON -->
                <a class="btn btn-primary" th:href="@{/projects/{id}/edit(id=${project.getId()})}">Edit</a>
            </td>
            <td>
                <!-- DELETE BUTTON -->
                <form th:method="DELETE" th:action="@{/projects/{id}(id=${project.getId()})}">
                    <input class="btn btn-primary" type="submit" value="Delete"/>
                </form>
            </td>
        </tr>
    </table>
</div>


<!-- OPEN VACS REPORT -->
<div class="container">

    <a class="btn btn-secondary" th:href="@{/projects/openvacs/{id}(id=${project.getId()})}+'?page=1'">Open vacancies</a>

</div>

<!-- FLAT LIST REPORT -->
<div class="container">

    <a class="btn btn-secondary" th:href="@{/report/vacflatlistbyproject/{name}/{date}    (name=${project.getName()},date=${currentDate})}+'?page=1'">Flat list of vacancies</a>

</div>
<!--  STATISTICS    -->

<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Salary Statistics</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Salary Range</th>
                            <th>Count</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Total vacancies</strong></td>
                            <td><span th:text="${total_vacs}">1879</span></td>
                            <td>100%</td>
                        </tr>
                        <tr class="table-success">
                            <td>Over 500,000 ₽</td>
                            <td><span th:text="${over500}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(over500 * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                        <tr>
                            <td>Over 400,000 ₽</td>
                            <td><span th:text="${over400}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(over400 * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                        <tr>
                            <td>Over 350,000 ₽</td>
                            <td><span th:text="${over350}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(over350 * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                        <tr>
                            <td>Over 300,000 ₽</td>
                            <td><span th:text="${over300}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(over300 * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                        <tr>
                            <td>Over 250,000 ₽</td>
                            <td><span th:text="${over250}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(over250 * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                        <tr>
                            <td>Over 200,000 ₽</td>
                            <td><span th:text="${over200}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(over200 * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                        <tr class="table-warning">
                            <td>Hidden salary</td>
                            <td><span th:text="${hiddensalary}">1879</span></td>
                            <td><span th:text="${#numbers.formatDecimal(hiddensalary * 100.0 / total_vacs, 1, 1)}">0.0</span>%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>



 <p></p>

<!-- SEARCH TEXTS TABLE -->

<div class="container">
    <h3>Search texts <span class="badge bg-secondary"></span></h3>
    <table class="table table-bordered">
        <tr>
            <th>text</th>
            <th>open vacancies</th>
            <th>vac count</th>
        </tr>
        <tr th:each="item : ${searchTextsList}"><!-- searchTextsList = List<Map<String,Object>> -->
            <!--<td th:text="${item.getText()}">java developer</td>-->
            <td>
                <!-- открыть страницу search text-->
                <!--<a href="" th:href="@{~/searchtexts/{sid}/project/{id}(id=${project.getId()},sid=${item.getId()})}" th:text="${item.getText()}">java developer</a>-->
                <a href="" th:href="@{~/searchtexts/{sid}/project/{id}(id=${project.getId()},sid=${item.get('searchTextDto').getId()})}" th:text="${item.get('searchTextDto').getText()}">java developer</a>
            </td>
            <td>
                <!-- open vacancies for search text-->
                <!--<a href="" th:href="@{/searchtexts/openvacs/{sid}/project/{id}(id=${project.getId()},sid=${item.getId()})}+'?page=1'">open vacancies</a>-->
                <a href="" th:href="@{/searchtexts/openvacs/{sid}/project/{id}(id=${project.getId()},sid=${item.get('searchTextDto').getId()})}+'?page=1'">open vacancies</a>

            </td>
            <!--<td> <span th:text="${item.getVacCount()}">123</span></td>-->
            <td> <span th:text="${item.get('vacCount')}">123</span></td>
        </tr>


        <tr th:remove="all">
            <td th:text="${item.getText()}">java developer</td>
        </tr>
        <tr th:remove="all">
            <td th:text="${item.getText()}">java architect</td>
        </tr>
    </table>
</div>


<p></p>

<!-- NEW VACANCIES FOR TODAY TABLE -->

<div th:if="${not #lists.isEmpty(newVacanciesList)}">
    <div class="container">
        <H5> NEW VACANCIES FOR 'TODAY': <span th:text="${dateOfNewVacancies}"></span>
            <a class="btn btn-sm btn-primary" th:href="@{/projects/newvacancies/{id}(id=${project.getId()})}">View All</a>
        </H5>
        <table class="table table-bordered">
            <tr>
                <th>#</th>
                <th>NAME</th>
                <th>SALARY</th>
                <th>REGION</th>
                <th>EMPLOYER</th>
            </tr>
                <tr th:each="vacancy, iterStat : ${newVacanciesList}" th:if="${iterStat.index < 10}">
                    <td th:text="${vacancy.getCount()}">999</td>
                    <td>
                        <a href="" th:href="@{/vacancies/{hhid}(hhid=${vacancy.getHhid()})}" th:text="${vacancy.getName()}">java developer</a>
                    </td>
                    <td th:text="${vacancy.getSalary_netto()}">300 000</td>
                    <td>
                        <span th:text="${vacancy.regionName}">Moscow</span>
                    </td>
                    <td>
                        <a href="" th:href="${vacancy.getEmployer_link()}" th:text="${vacancy.getEmployer()}">Sber</a>
                    </td>
                </tr>
        </table>
    </div>
</div>

<p></p>

<!-- CLOSED VACANCIES FOR TODAY TABLE -->

<div th:if="${not #lists.isEmpty(closedVacanciesList)}">
    <div class="container">
        <H5> CLOSED VACANCIES FOR 'TODAY': <span th:text="${dateOfNewVacancies}"></span>
            <a class="btn btn-sm btn-primary" th:href="@{/projects/closedvacancies/{id}(id=${project.getId()})}">View All</a>
        </H5>
        <table class="table table-bordered">
            <tr>
                <th>#</th>
                <th>NAME</th>
                <th>SALARY</th>
                <th>REGION</th>
                <th>EMPLOYER</th>
                <th>PUBLISHED</th>
            </tr>

            <tr th:each="vacancy, iterStat : ${closedVacanciesList}" th:if="${iterStat.index < 10}">
                <td th:text="${vacancy.getCount()}">999</td>
                <td>
                    <a href="" th:href="@{/vacancies/{hhid}(hhid=${vacancy.getHhid()})}" th:text="${vacancy.getName()}">java developer</a>
                </td>
                <td th:text="${vacancy.getSalary_netto()}">300 000</td>
                <td>
                    <span th:text="${vacancy.regionName}">Moscow</span>
                </td>
                <td>
                    <a href="" th:href="${vacancy.getEmployer_link()}" th:text="${vacancy.getEmployer()}">Sber</a>
                </td>
                <td th:text="${vacancy.getStartDate()}">2023-02-15</td>
            </tr>
        </table>
    </div>
</div>

<p></p>




<div class="container">
    <div th:replace="~{fragments/footer :: copyright}"></div>
</div>

</body>
</html>